{% extends 'prediction/base.html' %}

{% block title %}Prediction Results - RecoveryAI{% endblock %}

{% block content %}
<!-- Results Section -->
<section class="results-section">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-10">
                <!-- Success Header -->
                <div class="results-header text-center" data-aos="fade-down">
                    <div class="success-icon-wrapper">
                        <div class="success-icon">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="success-particles">
                            <span></span>
                            <span></span>
                            <span></span>
                            <span></span>
                        </div>
                    </div>
                    <h1 class="results-title">Prediction Complete!</h1>
                    <p class="results-subtitle">Your AI-powered recovery timeline analysis is ready</p>
                </div>

                <!-- Main Results Card -->
                <div class="results-main-card" data-aos="fade-up" data-aos-delay="200">
                    <div class="results-grid">
                        <!-- Category Result -->
                        <div class="result-box category-box">
                            <div class="result-icon">
                                <i class="fas fa-trophy"></i>
                            </div>
                            <h5 class="result-label">Recovery Category</h5>
                            <h2 class="result-value category-value 
                                {% if 'Short' in prediction.predicted_class %}success
                                {% elif 'Medium' in prediction.predicted_class %}warning
                                {% else %}danger{% endif %}">
                                {{ prediction.predicted_class }}
                            </h2>
                            <div class="result-decoration"></div>
                        </div>

                        <!-- Timeline Result -->
                        <div class="result-box timeline-box">
                            <div class="result-icon">
                                <i class="fas fa-clock"></i>
                            </div>
                            <h5 class="result-label">Estimated Timeline</h5>
                            <h2 class="result-value timeline-value">
                                {{ prediction.predicted_months }}
                                <span class="value-unit">months</span>
                            </h2>
                            <div class="result-decoration"></div>
                        </div>
                    </div>
                </div>

                <!-- Probability Analysis -->
                <div class="probability-card" data-aos="fade-up" data-aos-delay="300">
                    <div class="card-header-modern">
                        <h3><i class="fas fa-chart-pie"></i> Probability Analysis</h3>
                        <p>AI confidence breakdown across recovery categories</p>
                    </div>

                    <div class="probability-grid">
                        <!-- Short Term -->
                        <div class="probability-item">
                            <div class="prob-header">
                                <div class="prob-icon success">
                                    <i class="fas fa-bolt"></i>
                                </div>
                                <div>
                                    <h6>Short-term Recovery</h6>
                                    <span class="prob-range">0-6 months</span>
                                </div>
                            </div>
                            <div class="prob-bar-wrapper">
                                <div class="prob-bar">
                                    <div class="prob-fill success" style="width: {{ prediction.probability_short }}%" data-aos="width-animate" data-aos-delay="400">
                                        <span class="prob-value">{{ prediction.probability_short }}%</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Medium Term -->
                        <div class="probability-item">
                            <div class="prob-header">
                                <div class="prob-icon warning">
                                    <i class="fas fa-chart-line"></i>
                                </div>
                                <div>
                                    <h6>Medium-term Recovery</h6>
                                    <span class="prob-range">6-12 months</span>
                                </div>
                            </div>
                            <div class="prob-bar-wrapper">
                                <div class="prob-bar">
                                    <div class="prob-fill warning" style="width: {{ prediction.probability_medium }}%" data-aos="width-animate" data-aos-delay="500">
                                        <span class="prob-value">{{ prediction.probability_medium }}%</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Long Term -->
                        <div class="probability-item">
                            <div class="prob-header">
                                <div class="prob-icon danger">
                                    <i class="fas fa-hourglass-half"></i>
                                </div>
                                <div>
                                    <h6>Long-term Recovery</h6>
                                    <span class="prob-range">12+ months</span>
                                </div>
                            </div>
                            <div class="prob-bar-wrapper">
                                <div class="prob-bar">
                                    <div class="prob-fill danger" style="width: {{ prediction.probability_long }}%" data-aos="width-animate" data-aos-delay="600">
                                        <span class="prob-value">{{ prediction.probability_long }}%</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Circular Progress Visualization -->
                    <div class="circular-progress-wrapper" data-aos="zoom-in" data-aos-delay="700">
                        <canvas id="probabilityChart"></canvas>
                    </div>
                </div>

                <!-- Patient Information -->
                <div class="patient-info-card" data-aos="fade-up" data-aos-delay="400">
                    <div class="card-header-modern">
                        <h3><i class="fas fa-user-circle"></i> Patient Information</h3>
                        <p>Input data used for prediction</p>
                    </div>

                    <div class="info-grid">
                        <div class="info-item">
                            <div class="info-icon-small">
                                <i class="fas fa-calendar-alt"></i>
                            </div>
                            <div>
                                <span class="info-label">Age</span>
                                <span class="info-value">{{ prediction.age }} years</span>
                            </div>
                        </div>

                        <div class="info-item">
                            <div class="info-icon-small">
                                <i class="fas fa-venus-mars"></i>
                            </div>
                            <div>
                                <span class="info-label">Gender</span>
                                <span class="info-value">{{ prediction.gender }}</span>
                            </div>
                        </div>

                        <div class="info-item">
                            <div class="info-icon-small">
                                <i class="fas fa-pills"></i>
                            </div>
                            <div>
                                <span class="info-label">Drug Type</span>
                                <span class="info-value">{{ prediction.drug_type }}</span>
                            </div>
                        </div>

                        <div class="info-item">
                            <div class="info-icon-small">
                                <i class="fas fa-exclamation-triangle"></i>
                            </div>
                            <div>
                                <span class="info-label">Addiction Severity</span>
                                <span class="info-value">{{ prediction.addiction_severity }}/10</span>
                            </div>
                        </div>

                        <div class="info-item">
                            <div class="info-icon-small">
                                <i class="fas fa-chart-line"></i>
                            </div>
                            <div>
                                <span class="info-label">Daily Usage</span>
                                <span class="info-value">{{ prediction.daily_usage }} units/day</span>
                            </div>
                        </div>

                        <div class="info-item">
                            <div class="info-icon-small">
                                <i class="fas fa-clock"></i>
                            </div>
                            <div>
                                <span class="info-label">Years Using</span>
                                <span class="info-value">{{ prediction.years_using }} years</span>
                            </div>
                        </div>

                        <div class="info-item">
                            <div class="info-icon-small">
                                <i class="fas fa-brain"></i>
                            </div>
                            <div>
                                <span class="info-label">Mental Health</span>
                                <span class="info-value">{{ prediction.mental_health_score }}/10</span>
                            </div>
                        </div>

                        <div class="info-item">
                            <div class="info-icon-small">
                                <i class="fas fa-hospital"></i>
                            </div>
                            <div>
                                <span class="info-label">Recovery Program</span>
                                <span class="info-value program-badge">
                                    {% if prediction.recovery_program == 0 %}No Program
                                    {% elif prediction.recovery_program == 1 %}Outpatient
                                    {% elif prediction.recovery_program == 2 %}Intensive Outpatient
                                    {% elif prediction.recovery_program == 3 %}Partial Hospitalization
                                    {% elif prediction.recovery_program == 4 %}Residential/Inpatient
                                    {% elif prediction.recovery_program == 5 %}12-Step Program
                                    {% elif prediction.recovery_program == 6 %}MAT
                                    {% elif prediction.recovery_program == 7 %}Holistic/Alternative
                                    {% endif %}
                                </span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Disclaimer -->
                <div class="disclaimer-card" data-aos="fade-up" data-aos-delay="500">
                    <div class="disclaimer-icon">
                        <i class="fas fa-info-circle"></i>
                    </div>
                    <div class="disclaimer-content">
                        <h5>Important Medical Disclaimer</h5>
                        <p>This prediction is generated by machine learning algorithms based on statistical patterns and should be used for informational purposes only. It does not constitute medical advice, diagnosis, or treatment recommendations. Always consult qualified healthcare professionals for personalized medical guidance and treatment decisions.</p>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="action-buttons" data-aos="fade-up" data-aos-delay="600">
                    <a href="{% url 'predict' %}" class="btn-action btn-primary">
                        <i class="fas fa-redo"></i>
                        <span>New Prediction</span>
                    </a>
                    <a href="{% url 'home' %}" class="btn-action btn-secondary">
                        <i class="fas fa-home"></i>
                        <span>Back to Home</span>
                    </a>
                    <button onclick="window.print()" class="btn-action btn-tertiary">
                        <i class="fas fa-download"></i>
                        <span>Download Report</span>
                    </button>
                    <button onclick="shareResults()" class="btn-action btn-quaternary">
                        <i class="fas fa-share-alt"></i>
                        <span>Share Results</span>
                    </button>
                </div>
            </div>
        </div>
    </div>
</section>

<style>
/* Results Section Styles */
.results-section {
    padding: 120px 0 80px;
    min-height: 100vh;
}

.results-header {
    margin-bottom: 50px;
}

.success-icon-wrapper {
    position: relative;
    display: inline-block;
    margin-bottom: 30px;
}

.success-icon {
    width: 120px;
    height: 120px;
    background: linear-gradient(135deg, var(--success), var(--accent));
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 4rem;
    color: white;
    box-shadow: 0 20px 60px rgba(16, 185, 129, 0.4);
    animation: successPulse 2s ease-in-out infinite;
}

@keyframes successPulse {
    0%, 100% {
        transform: scale(1);
        box-shadow: 0 20px 60px rgba(16, 185, 129, 0.4);
    }
    50% {
        transform: scale(1.05);
        box-shadow: 0 25px 70px rgba(16, 185, 129, 0.6);
    }
}

.success-particles {
    position: absolute;
    width: 100%;
    height: 100%;
    top: 0;
    left: 0;
}

.success-particles span {
    position: absolute;
    width: 8px;
    height: 8px;
    background: var(--success);
    border-radius: 50%;
    animation: particleFloat 3s ease-in-out infinite;
}

.success-particles span:nth-child(1) { top: 20%; left: 20%; animation-delay: 0s; }
.success-particles span:nth-child(2) { top: 20%; right: 20%; animation-delay: 0.5s; }
.success-particles span:nth-child(3) { bottom: 20%; left: 20%; animation-delay: 1s; }
.success-particles span:nth-child(4) { bottom: 20%; right: 20%; animation-delay: 1.5s; }

@keyframes particleFloat {
    0%, 100% {
        transform: translateY(0) scale(1);
        opacity: 1;
    }
    50% {
        transform: translateY(-30px) scale(1.5);
        opacity: 0;
    }
}

.results-title {
    font-size: 3rem;
    font-weight: 700;
    background: linear-gradient(135deg, var(--success), var(--accent));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    margin-bottom: 15px;
}

.results-subtitle {
    font-size: 1.2rem;
    color: var(--text-secondary);
}

/* Main Results Card */
.results-main-card {
    background: var(--bg-secondary);
    border: 1px solid var(--border-color);
    border-radius: 30px;
    padding: 40px;
    box-shadow: var(--shadow-xl);
    margin-bottom: 30px;
}

.results-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 30px;
}

.result-box {
    background: var(--bg-primary);
    border: 2px solid var(--border-color);
    border-radius: 25px;
    padding: 40px;
    text-align: center;
    position: relative;
    overflow: hidden;
    transition: var(--transition);
}

.result-box:hover {
    transform: translateY(-10px);
    box-shadow: var(--shadow-xl);
}

.result-icon {
    width: 80px;
    height: 80px;
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    border-radius: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 20px;
    font-size: 2.5rem;
    color: white;
    box-shadow: 0 10px 30px rgba(139, 92, 246, 0.3);
}

.result-label {
    font-size: 1rem;
    color: var(--text-muted);
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 1px;
    margin-bottom: 15px;
}

.result-value {
    font-size: 2.5rem;
    font-weight: 800;
    margin-bottom: 10px;
}

.category-value {
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.category-value.success {
    background: linear-gradient(135deg, var(--success), var(--accent));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.category-value.warning {
    background: linear-gradient(135deg, var(--warning), #fbbf24);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.category-value.danger {
    background: linear-gradient(135deg, var(--danger), #fb7185);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.timeline-value {
    color: var(--primary);
}

.value-unit {
    font-size: 1.2rem;
    color: var(--text-muted);
    font-weight: 500;
}

.result-decoration {
    position: absolute;
    bottom: -50px;
    right: -50px;
    width: 150px;
    height: 150px;
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    opacity: 0.05;
    border-radius: 50%;
}

/* Probability Card */
.probability-card,
.patient-info-card,
.disclaimer-card {
    background: var(--bg-secondary);
    border: 1px solid var(--border-color);
    border-radius: 30px;
    padding: 40px;
    box-shadow: var(--shadow-xl);
    margin-bottom: 30px;
}

.card-header-modern {
    margin-bottom: 30px;
    padding-bottom: 20px;
    border-bottom: 2px solid var(--border-color);
}

.card-header-modern h3 {
    font-size: 1.8rem;
    font-weight: 600;
    margin-bottom: 10px;
    color: var(--text-primary);
}

.card-header-modern h3 i {
    color: var(--primary);
    margin-right: 10px;
}

.card-header-modern p {
    color: var(--text-secondary);
    margin: 0;
}

.probability-grid {
    display: flex;
    flex-direction: column;
    gap: 25px;
    margin-bottom: 40px;
}

.probability-item {
    background: var(--bg-primary);
    border-radius: 20px;
    padding: 25px;
    border: 1px solid var(--border-color);
}

.prob-header {
    display: flex;
    align-items: center;
    gap: 15px;
    margin-bottom: 15px;
}

.prob-icon {
    width: 50px;
    height: 50px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    color: white;
}

.prob-icon.success {
    background: linear-gradient(135deg, var(--success), var(--accent));
}

.prob-icon.warning {
    background: linear-gradient(135deg, var(--warning), #fbbf24);
}

.prob-icon.danger {
    background: linear-gradient(135deg, var(--danger), #fb7185);
}

.prob-header h6 {
    font-size: 1.1rem;
    font-weight: 600;
    margin: 0;
}

.prob-range {
    font-size: 0.9rem;
    color: var(--text-muted);
}

.prob-bar-wrapper {
    position: relative;
}

.prob-bar {
    height: 40px;
    background: var(--bg-tertiary);
    border-radius: 20px;
    overflow: hidden;
    position: relative;
}

.prob-fill {
    height: 100%;
    border-radius: 20px;
    display: flex;
    align-items: center;
    justify-content: flex-end;
    padding-right: 15px;
    transition: width 1s ease;
}

.prob-fill.success {
    background: linear-gradient(90deg, var(--success), var(--accent));
}

.prob-fill.warning {
    background: linear-gradient(90deg, var(--warning), #fbbf24);
}

.prob-fill.danger {
    background: linear-gradient(90deg, var(--danger), #fb7185);
}

.prob-value {
    color: white;
    font-weight: 700;
    font-size: 1.1rem;
}

/* Circular Progress */
.circular-progress-wrapper {
    max-width: 400px;
    margin: 0 auto;
    padding: 20px;
}

#probabilityChart {
    max-width: 100%;
    height: auto;
}

/* Patient Info Grid */
.info-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
}

.info-item {
    background: var(--bg-primary);
    border: 1px solid var(--border-color);
    border-radius: 15px;
    padding: 20px;
    display: flex;
    align-items: center;
    gap: 15px;
    transition: var(--transition);
}

.info-item:hover {
    border-color: var(--primary);
    transform: translateX(5px);
}

.info-icon-small {
    width: 45px;
    height: 45px;
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 1.2rem;
    flex-shrink: 0;
}

.info-item > div {
    flex: 1;
}

.info-label {
    display: block;
    font-size: 0.85rem;
    color: var(--text-muted);
    margin-bottom: 5px;
}

.info-value {
    display: block;
    font-size: 1.1rem;
    font-weight: 600;
    color: var(--text-primary);
}

.program-badge {
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

/* Disclaimer */
.disclaimer-card {
    background: linear-gradient(135deg, rgba(245, 158, 11, 0.1), rgba(251, 191, 36, 0.05));
    border: 2px solid rgba(245, 158, 11, 0.3);
}

.disclaimer-card {
    display: flex;
    gap: 20px;
}

.disclaimer-icon {
    width: 60px;
    height: 60px;
    background: var(--warning);
    border-radius: 15px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 2rem;
    flex-shrink: 0;
}

.disclaimer-content h5 {
    font-size: 1.2rem;
    font-weight: 600;
    margin-bottom: 10px;
    color: var(--warning);
}

.disclaimer-content p {
    color: var(--text-secondary);
    margin: 0;
    line-height: 1.6;
}

/* Action Buttons */
.action-buttons {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
}

.btn-action {
    padding: 18px 30px;
    border-radius: 15px;
    border: none;
    font-weight: 600;
    font-size: 1rem;
    cursor: pointer;
    transition: var(--transition);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    text-decoration: none;
}

.btn-action i {
    font-size: 1.2rem;
}

.btn-primary {
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    color: white;
}

.btn-secondary {
    background: var(--bg-tertiary);
    color: var(--text-primary);
    border: 2px solid var(--border-color);
}

.btn-tertiary {
    background: linear-gradient(135deg, var(--success), var(--accent));
    color: white;
}

.btn-quaternary {
    background: linear-gradient(135deg, var(--accent), #06b6d4);
    color: white;
}

.btn-action:hover {
    transform: translateY(-5px);
    box-shadow: var(--shadow-xl);
}

/* Print Styles */
@media print {
    .results-section {
        padding: 20px;
    }
    
    .action-buttons,
    nav,
    footer,
    .theme-toggle {
        display: none;
    }
}

/* Responsive */
@media (max-width: 768px) {
    .results-main-card,
    .probability-card,
    .patient-info-card,
    .disclaimer-card {
        padding: 25px 20px;
    }
    
    .results-title {
        font-size: 2rem;
    }
    
    .result-value {
        font-size: 2rem;
    }
    
    .action-buttons {
        grid-template-columns: 1fr;
    }
    
    .info-grid {
        grid-template-columns: 1fr;
    }
}
</style>

<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Animate probability bars
    setTimeout(() => {
        document.querySelectorAll('.prob-fill').forEach(fill => {
            fill.style.width = fill.getAttribute('style').match(/width:\s*(\d+)%/)[1] + '%';
        });
    }, 300);

    // Create circular chart
    const ctx = document.getElementById('probabilityChart');
    if (ctx) {
        new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: ['Short-term (0-6 months)', 'Medium-term (6-12 months)', 'Long-term (12+ months)'],
                datasets: [{
                    data: [
                        {{ prediction.probability_short }},
                        {{ prediction.probability_medium }},
                        {{ prediction.probability_long }}
                    ],
                    backgroundColor: [
                        'rgba(16, 185, 129, 0.8)',
                        'rgba(245, 158, 11, 0.8)',
                        'rgba(239, 68, 68, 0.8)'
                    ],
                    borderColor: [
                        'rgba(16, 185, 129, 1)',
                        'rgba(245, 158, 11, 1)',
                        'rgba(239, 68, 68, 1)'
                    ],
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            color: getComputedStyle(document.documentElement).getPropertyValue('--text-primary'),
                            padding: 15,
                            font: {
                                size: 12
                            }
                        }
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return context.label + ': ' + context.parsed + '%';
                            }
                        }
                    }
                }
            }
        });
    }
});

function shareResults() {
    if (navigator.share) {
        navigator.share({
            title: 'Recovery Prediction Results',
            text: 'Check out my recovery timeline prediction from RecoveryAI',
            url: window.location.href
        }).catch(err => console.log('Error sharing:', err));
    } else {
        alert('Sharing is not supported on this browser. You can copy the URL to share.');
    }
}
</script>
{% endblock %}